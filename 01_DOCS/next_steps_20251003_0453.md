# NEXT_STEPS — 20251003_0453

This file records tactical tasks derived from the pinned RP5 quickstart prompt.

## Immediate Tasks
1. Implement stable JSON for `--plan`/`--dry-run`.
2. Wire `assert_cmdline_uuid()` and `verify_initramfs()` into main path.
3. Install postboot one-shot that writes BOOT_OK marker; have `postcheck` verify it.
4. Standardize RESULT markers and exit codes; tee logs to canonical paths.
5. Add source-root guard and `--force` override.
6. Bundle full recovery artifacts.

---
# Rolled in: rolling_work_20251002_215844.md
# Rolling Work — 20251002_215844

## Goal
Make NVMe OS provisioning and first boot flawless starting from `cli.py`.

## Changes
- Default full-run; ``--yes` (full provision)` removed.
- ``--do-postcheck`` + ``--do-postcheck`` → `--do-postcheck`.
- `(removed; see `docs/usage/provisioning.md`)`/`(removed; see `docs/usage/provisioning.md`)` removed.
- Safety rails: abort if target==root disk; disallow `--skip-rsync` in full-run.
- Clearer initramfs verify hints.
- TPM keyscript left for last mile.

---
# Rolled in: rolling_work_20251002_225009.md
# Rolling Work — 20251002_225009

## Summary
- Fixed Python scoping issue by ensuring global `import os` in `cli.py` and removing inner imports.
- Removed unsupported `--force` from `cryptsetup luksFormat` in `luks_lvm.py`.
- Ensured passphrase path uses `os.path.expanduser`.
- Re-confirmed canonical packaging rules and exclusions in docs.

---
# Rolled in: rolling_work_20251002_231039.md
# Rolling Work — 20251002_231039

## Change
- Implemented **non-destructive** `--do-postcheck` mode (no partitioning/LUKS formatting/rsync). Uses passphrase file to open and mount, then installs postboot check and writes recovery doc.

---
# Rolled in: rolling_work_20251002_231336.md
# Rolling Work — 20251002_231336

## Change
- Reordered logic so `--plan`/`--dry-run` return before any confirm or write operations (strictly non-destructive).
- Removed in-function `from devices import probe` to avoid local-shadowing errors.

---
# Rolled in: rolling_work_20251003_001658.md
# Rolling Work — 20251003_001658

- Added `docs/usage/provisioning.md` with canonical entrypoint and examples.
- Updated README to reference usage doc.
- Swept docs for deprecated flags and script names; replaced with current guidance.
