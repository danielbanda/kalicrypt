{
  "result": "PLAN_OK",
  "ts": 1759837918,
  "mode": "plan",
  "plan": {
    "device": "/dev/nvme0n1",
    "esp_mb": 256,
    "boot_mb": 512,
    "passphrase_file": "/home/admin/secret.txt",
    "device_map": {
      "device": "/dev/nvme0n1",
      "p1": "/dev/nvme0n1p1",
      "p2": "/dev/nvme0n1p2",
      "p3": "/dev/nvme0n1p3",
      "luks_name": "cryptroot",
      "vg": "rp5vg",
      "lv": "root",
      "root_lv_path": null
    },
    "detected": {
      "vg": "rp5vg",
      "lv": "root",
      "root_lv_path": null,
      "root_mapper": "/dev/mapper/rp5vg-root"
    }
  },
  "flags": {
    "plan": true,
    "dry_run": false,
    "skip_rsync": false,
    "do_postcheck": false,
    "tpm_keyscript": false,
    "assume_yes": false
  },
  "uuids": {
    "p1": null,
    "p2": null,
    "luks": null
  },
  "state": {
    "root_source": "/dev/sda2",
    "holders": [
      "nvme0n1     disk",
      "nvme0n1p1 part",
      "nvme0n1p2 part",
      "nvme0n1p3 part"
    ],
    "lsblk": [
      "NAME             TYPE    SIZE RO DISC-ALN DISC-GRAN DISC-MAX DISC-ZERO MOUNTPOINT",
      "sda              disk   28.9G  0        0        0B       0B         0 ",
      "\u251c\u2500sda1           part    255M  0        0        0B       0B         0 /boot/firmware",
      "\u2514\u2500sda2           part   28.7G  0        0        0B       0B         0 /",
      "nvme0n1          disk  238.5G  0        0      512B       2T         0 ",
      "\u251c\u2500nvme0n1p1      part    256M  0        0      512B       2T         0 /mnt/nvme/boot/firmware",
      "\u251c\u2500nvme0n1p2      part    512M  0        0      512B       2T         0 /mnt/nvme/boot",
      "\u2514\u2500nvme0n1p3      part  237.7G  0        0      512B       2T         0 ",
      "  \u2514\u2500cryptroot    crypt 237.7G  0        0        0B       0B         0 ",
      "    \u2514\u2500rp5vg-root lvm   237.7G  0        0        0B       0B         0 "
    ],
    "lsblk_verbose": {
      "blockdevices": [
        {
          "name": "sda",
          "type": "disk",
          "size": "28.9G",
          "mountpoint": null,
          "mountpoints": [
            null
          ],
          "children": [
            {
              "name": "sda1",
              "type": "part",
              "size": "255M",
              "fstype": "vfat",
              "mountpoint": "/boot/firmware",
              "mountpoints": [
                "/boot/firmware"
              ]
            },
            {
              "name": "sda2",
              "type": "part",
              "size": "28.7G",
              "fstype": "ext4",
              "mountpoint": "/",
              "mountpoints": [
                "/"
              ]
            }
          ]
        },
        {
          "name": "nvme0n1",
          "type": "disk",
          "size": "238.5G",
          "mountpoint": null,
          "mountpoints": [
            null
          ],
          "children": [
            {
              "name": "nvme0n1p1",
              "type": "part",
              "size": "256M",
              "fstype": "vfat",
              "mountpoint": "/mnt/nvme/boot/firmware",
              "mountpoints": [
                "/mnt/nvme/boot/firmware"
              ]
            },
            {
              "name": "nvme0n1p2",
              "type": "part",
              "size": "512M",
              "fstype": "ext4",
              "mountpoint": "/mnt/nvme/boot",
              "mountpoints": [
                "/mnt/nvme/boot"
              ]
            },
            {
              "name": "nvme0n1p3",
              "type": "part",
              "size": "237.7G",
              "fstype": "crypto_LUKS",
              "mountpoint": null,
              "mountpoints": [
                null
              ],
              "children": [
                {
                  "name": "cryptroot",
                  "type": "crypt",
                  "size": "237.7G",
                  "mountpoint": null,
                  "mountpoints": [
                    null
                  ],
                  "children": [
                    {
                      "name": "rp5vg-root",
                      "type": "lvm",
                      "size": "237.7G",
                      "fstype": "ext4",
                      "mountpoint": "/mnt/nvme",
                      "mountpoints": [
                        "/mnt/nvme"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    "same_underlying_disk": false
  },
  "steps": [
    "swapoff_all()",
    "kill_holders(device)",
    "apply_layout(device, esp_mb, boot_mb)",
    "verify_layout(device)",
    "format_luks(p3, passphrase_file)",
    "open_luks(p3, luks_name, passphrase_file)",
    "make_vg_lv(vg, lv)",
    "mount_targets()/bind_mounts()",
    "populate_esp()/assert_essentials()",
    "rsync_root(target, exclude_boot=True)",
    "write fstab/crypttab/cmdline + assert UUIDs",
    "ensure_packages()/rebuild()/verify_initramfs()",
    "unmount_all()/close_luks()/deactivate_vg()",
    "emit RESULT codes (ETE_PREBOOT_OK -> ETE_DONE_OK)"
  ],
  "rsync": {
    "skip": false,
    "exclude_boot": true
  },
  "initramfs": {
    "image": null
  },
  "postcheck": {
    "requested": false,
    "offer": "--do-postcheck"
  },
  "timestamp": 1759837918,
  "artifact": "/root/rp5/03_LOGS/plan_20251007_045158.json"
}
